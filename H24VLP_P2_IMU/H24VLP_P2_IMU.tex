%TODO:
% should I add GS10 data for students to check?
% correct document
% add new template


\documentclass[british]{book}
\usepackage[T1]{fontenc}
\usepackage[latin9]{inputenc}
\usepackage{geometry}
\geometry{verbose,tmargin=3cm,bmargin=3.7cm,lmargin=3cm,rmargin=2cm,headheight=1cm,headsep=1cm,footskip=0.7cm}
\setcounter{secnumdepth}{3}

\setlength{\parskip}{\medskipamount}
\setlength{\parindent}{0pt}
\usepackage{babel}
\usepackage{array}
\usepackage{verbatim}
\usepackage{refstyle}
\usepackage{booktabs}
\usepackage{textcomp}
\usepackage{url}
\usepackage{multirow}
\usepackage{graphicx}
\usepackage[unicode=true,
 bookmarks=true,bookmarksnumbered=false,bookmarksopen=false,
 breaklinks=false,pdfborder={0 0 1},backref=false,colorlinks=false]
 {hyperref}
 
\hypersetup{pdftitle={H24VLP Project 2},
 pdfauthor={Lukasz K Bonenberg},
 pdfsubject={teaching},
 pdfkeywords={Integration, GNSS, IMU, LC}}
\makeatletter
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% LyX specific LaTeX commands.



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% User specified LaTeX commands.
\input{Preamble.tex} %my math + CROSSREF+nomenclature
\input{stdSent.tex} %shortcuts and refs
\AtBeginDocument{
  \def\labelitemii{\(\circ\)}
}
\makeatother

\usepackage{tcolorbox}
\usepackage{lipsum}

%playing with TOC - one page fit
\usepackage{etoolbox}
\makeatletter
\patchcmd{\l@chapter}{1.0em}{0.8em}{}{}
\makeatother


%page xx of xx
\usepackage{lastpage}
\usepackage{fancyhdr}


\renewcommand{\footnotesize}{\scriptsize} %change footnote sizes
\newcommand{\thisDocRef}{\footnote{History of changes at \url{https://github.com/DfAC/TeachingSlides/tree/master/H24VLP_P2_IMU}.}}
\newcommand{\moreInfo}[1]{\footnote{For more details check \url{#1}.}}


\begin{document}
\global\long\def\units#1{\textrm{\ensuremath{\mathbf{[\si{#1}]}}}}
%restart numbering for each Part
\makeatletter
\@addtoreset{section}{part}
\makeatother 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% DOCUMENT STARTED
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{titlepage}
\title{\includegraphics[width=7cm]{./../bigLogo.png}\vspace*{5cm}
\\
\textbf{H24VLP Location Technology\\ Project 2}
\\Integration of GNSS and INS
}
\author{Dr Lukasz Kosma Bonenberg}
\maketitle
\thispagestyle{empty}%no number on this page
\end{titlepage}
\pagebreak{}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%FRONT MATTER
%\frontmatter %to get i,ii
%\setcounter{page}{1}

%intro table of content
	
	\setcounter{tocdepth}{1} %how deep are we going to go
	\tableofcontents
	%\addtocontents{toc}{~\hfill\textbf{Page}\par} % ?Page? on top of the page numbers in toc/lof/lot

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% MAIN DOC %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
%\mainmatter %so we can get proper numbering again


\chapter{Introduction}
\setcounter{page}{1} %start from 1

Welcome to the second Project of H24VLP Location Technology Practical. We will focus on navigation applications of the Inertial Navigation Systems (IMS) using a integrated GNSS and IMU system deployed on a moving platform (NGI Van). This practical is supporting Learning outcomes are:

\begin{itemize}
	\item Practical understanding of the IMU;
	\item Practical understanding of the IMS;
	\item Ability to process and analyse the IMS dataset;
	\item Understand the advantages and limitations of integrated GNSS and INU system.

\end{itemize}

We will use an existing dataset, with the route combining three different environments:

\begin{itemize}
	\item semi-urban;
	\item rural;
	\item dense urban (down town).
\end{itemize}

The goal of this practical is to understand the advantages and limitations of integrated GNSS and INU systems. You will gain it by assessing the performance of three types of IMU sensor:

\begin{itemize}
	\item navigation grade POSRS unit with Digital Laser gyros;
	\item tactical grade SPAN LCI with fiber optic gyros;
	\item low cost Microstrain 3DM-GX4-25 with MEMS sensor.
\end{itemize}


\section{Layout of the practical}

This practical will span two supervised lab classes, with aim to provide you with tools and knowledge to complete the task. Apart from that, you are expected to work in your own time, and to facilitate this, each group will be provided with two IE dongles for the duration of thee weeks.

\begin{description}
	\item [{Week~1}] Introduction to the practical. By the end of this practical you should
	have processed all GNSS data and get ready to process IMU data.
	\item [{Week~2}] IMS processing. By the end you should have processed
	all IMS data and start introducing data gaps.
	\item [{Week~3}] Group presentation.
\end{description}

\section{Dataset description}

Approximately 90 minutes trajectory have been collected using NGI van, demonstrated to you earlier. Trial was run in around Nottingham (see figure \ref{fig:Van-trajectory}) starting and ending with a static period\footnote{You will explore both GNSS and IMU data to identify those periods properly.}. NGB2 was used as a reference station for the duration of the trials.
Figure \ref{Van-experiment-layout} and table \ref{Lever-Arm-Values} demonstrate experimental setup used.

All collected data has been converted to \emph{Inertial Explorer} native format. Those files are:
	\begin{description}
	\item [{NGB2.{*}}] NGB2 reference station;
	\item [{POSRS.{*}}] IMU and GNSS data for POSRS (navigation grade);
	\item [{SPAN\_54.{*}}] IMU and GNSS data for SPAN (tactical grade);
	\item [{microstrain.imr}] IMU data for low cost Microstrain IMU;
	\end{description}


\section{Supporting Document on Moodle}

Following document are also provided for your reference:

	\begin{description}
	\item [{POSRS.pdf}] Document outlining POSRS characteristics;
	\item [{SPAN.pdf}] Document outlining SPAN characteristics;
	\item [{Microstrain.pdf}] Document outlining Microstrain characteristics;
	\item [{InertialExplorer850\_Manual.pdf}] Full manual for IE 8.50;
	\item [{H24VLP\_P2\_IMU.pdf}] This document\thisDocRef.
	\end{description}

\section{Handling of data}

You are being provided with all relevant data from onset of your project. I suggest:

\begin{itemize}
	\item Keep all your data in a single project folder structure which you can backup on your own computer before leaving the Photogrammetry Lab;
	\item Place all given data file in the same  \\RAW subfolder
	\item Create the separate project file for each IMU and put them in the project folder (main folder of the \\RAW subfolder);
	\item Please name each project accordingly (GNSS, SPAN, POSRS, MicroStrain ect); 
	\item IE is producing a large number of files - the critical ones are \textit{*.cfg}, all other ones can be restored from RAW data.
\end{itemize}


\section{Workflow}

In order to process and understand the data, you will have to:

\begin{enumerate}
	%\item Create a separate project for GNSS processing and for each IMU (SPAN,	POSRS, MicroStrain), \refLoc{sec:sec:Create-an-new};
	\item Process SPAN vs NGB2 data, \refLoc{sec:Processing-GNSS-data}. The aim of this step is to: 
	\begin{enumerate}
		\item Identify static periods for IMU processing;
		\item Create an ideal GNSS trajectory, that will be used in next steps.
	\end{enumerate}
	\item Process Loosely Coupled (LC) IMU and GNSS data. You will:
	\begin{enumerate}
		\item Process POSRS, using GNSS.cmb \footnote{This is trajectory created in the previous step.}, \refLoc{sub:Processing-POSRS};
		\item Process SPAN, using GNSS.cmb and by transferring alignment from POSRS, \refLoc{sub:Processing-SPAN};
		\item Process Microstrain, using GNSS.cmb and transferring alignment from POSRS, \refLoc{sub:Processing-Microstrain}).
	\end{enumerate}
	\item Process only IMU data (without GPS data) for each sensor, \refLoc{Processing-IMU-on-its-own}. You will use this to estimate the required GNSS gaps for each IMU system. Use this step to better understand limitations of each sensor. 
	\item You will introduce artificial GNSS denied environment, by introducing gaps (outages) in the GNSS data set for each sensor, \refLoc{Simulating-GNSS-outage}. The aim here is: 
	\begin{enumerate}
	\item Verify your understanding of last step;
	\item Demonstrate the performance of each integrated GNSS and INS system for navigation, by highlighting differences between systems.
	\item Duration of GNSS gaps, combined with exploratory analysis of all results should allow you to \textbf{Characterise the performance of each integrated GNSS and INS system for navigation and tracking applications}.
	\end{enumerate}
	\item Draw conclusions and prepare presentation by visualising and summarising your work. While a brief description of outputs provided by IE can be found in section \ref{sec:Exporting-final-results}, you are expected to show your own judgement and expertise in selecting output supporting your narrative. It is likely that IE output will be sufficient for that, but you are welcome to summarise some of the results in the tables or plot additional graphs using comparing exported coordinates.
\end{enumerate}


Following section will explain the basics of using IE, which should be sufficient to carry out the required task. If you need more information check the \textbf{Inertial Explorer Manual} provided.



\chapter{Processing GNSS data}\label{sec:Processing-GNSS-data}


To compare performance of IMU component, we will use the same GNSS data set for each project - SPAN GNSS data, collected at 1Hz observation rate.

\section{Creating a new project}\label{sec:Create-an-new}

\begin{itemize}
	\item Open \emph{Inertial Explorer} and go to \textbf{\emph{File->New Project->Project Wizard}};
	\item Navigate to project folder and create a new project - GNSS;
	\item We will use SPAN GNSS data as a rover;
	\begin{enumerate}
		\item Select required GNSS \& IMU files (SPAN\_54.{*});
		\item antenna height 0m, Measured to APR, use antenna profile as per figure \ref{fig:Van-experiment-layout};
		\item Next;
	\end{enumerate}
	\item We will use NGB2 as reference station;
	\begin{enumerate}
		\item Select \textit{I would like add Base Station Data};
		\item Select \textit{Add Station From File} and select NGB2.{*} files;
		\item antenna height 0.502m, profile \emph{LEIAR25.R4};
		\item position 52\textdegree{}57'06.95636"N  1\textdegree{}11'02.39879"W  91.2006m;
		\item Measured to APR;
		\item NEXT, NEXT, Finish, Finish.
	\end{enumerate}
\end{itemize}


\section{Processing GNSS data}\label{sec:GPS-process}

To process data select \textbf{\emph{Process->Process GNSS}} or press \textbf{\emph{F5}}

\begin{itemize}
	\item Processing Method: \emph{Differential GNSS;}
	\item Processing Direction: \emph{Both};
	\item Profile GNSS: \emph{Ground Vehicle}, don't change any \emph{Advanced..}
	options;
	\item Make sure th add description/User name - we can recover previous settings so description is very important.
\end{itemize}


\subsection{Understand the data}

With complex dataset it is important to fully understand the dataset. First check overview summary using \textbf{\emph{View->Processing summary}}. To visualise data go to \textbf{\emph{Output->Plot Results} or press \textbf{F7}}.

\begin{itemize}
	\item Lets start with looking at data overlap by selecting\emph{ File Data Coverage} plot. 
	\item Check plot settings.
	\item To check quality of the position use the following plots:
	\begin{itemize}
		\item Combined Separation
		\item Combined Separation(Fix)
		\item Estimated Position Accuracy
		\item Quality factor
		\item Float/Fixed Ambiguity Status
\end{itemize}
	\item To obtian more information about our baseline use the following plots:
	\begin{itemize}
		\item Local Level Vector - check the height component, is there anything you should be concerned with?
		\item Distance Separation
		\item RMS - Carrier Phase
	\end{itemize}
\end{itemize}

\NOTE{
Every plot have menu accessible by right clicking on it. Selecting \emph{Properties }allows to modify plot display\emph{.} Plot range can be modified from same menu using \emph{X-Axis} and \emph{Y-Axis. Apply to All }subcommand match all open plots to the current one.\emph{ Compute statistics for... }provide quantification of plot data. Use \textbf{\emph{Ctr+C}} to copy window content. If you ever close background map, use \textbf{\emph{Output->Show Map window }}.
}



\section{Improving GNSS data}

This section discuss how we can improve quality of the data.


\subsection{Precise Clocks/Orbits}

The precise orbits/clocks latency is 12-18 days, with the rapid product available for GPS rapid within the day\moreInfo{http://bit.ly/IGS_products}. This is useful for baselines exceeding 15km or if you suspect problems with broadcast ephemerides. It will automatically download files relevant to the current project. To do so 

\begin{itemize}
	\item Select \textbf{\emph{File->Add precise Files}};
	\item Check if time and date is correct, tick GLONASS and press Download for combined GPS and GLONASS data (some files might be overwritten)\footnote{GPS only data provide higher resolution clocks, which might be useful for PPP.};
	\item Press OK to exit window;
	\item In \textbf{\emph{View->Project Overview}} you should be able to see all the files you added;
	\item Re-process GPS data,\refLoc{sec:GPS-process}.
\end{itemize}


\subsection{Introducing static data in GNSS processing}

For the successful initialisation of IMUs we need to identify the static periods at the beginning and the end of dataset. We can do using GNSS data only, improving its accuracy in the process - IE is using extended kalman filter (EKF)\moreInfo{https://getpocket.com/a/read/1008419114} for calculations and will use different settings based on the rover static or kinematic status.
%http://bilgin.esme.org/BitsAndBytes/KalmanFilterforDummies


\subsubsection{Looking for static periods\label{sec:Static-periods}}

\begin{itemize}
\item use \emph{Acceleration Profile} or \emph{Velocity Profile} plots to identify static periods.
\item create new file Static.txt with each row identifying static period as NAME~START\_TIME~END\_TIME~NOTE (see IE manual page 32 for details or follow this example: 
	\begin{lstlisting} [language=Matlab,backgroundcolor=\color{lightgray},frame=single,basicstyle=\footnotesize,numbers=left,numbersep=5pt, numberstyle=\tiny\color{mygray}]
		NGI_Start 201200.0 203505.0 Intial_Period_NGB_Yard
		NGI_End 221200.0 223505.0 End_Period_NGB_Yard
	\end{lstlisting}
\item use \textbf{View->GNSS Observations->Remote->Insert Static/Kinematic Markers} and select \textit{Use user generated file to define static periods} to import static data;
\item plot \textit{File data coverage} to check if data is properly changed;
\item process GNSS data again;
\item Assess each static period using \emph{Static Session Convergence} plots; 
\item .
\end{itemize}

. Once you happy with identified static periods (they should be between 5-10 min long) compare results using any other plots that we discussed. Similar as in last project you can use to plots to indentify the poor satelites, fine tune processing parameters or change cut off angle. Once you happy with results save and exit the project. As an extra precaution you might consider making a copy of \textit{GNSS.cmb} and re-naming it, for example as \textit{GoodData.cmb}. 

 so far note beginning and end of whole dataset (that is from first static period to end of last static period identified). Whole processing  generated SPAN.cmb file (combined GPS file). You are going to be using this file later, so please make a copy of it and re-namne it, for example GoodData.cmb. 



\chapter{Processing LC GNSS/IMU data\label{sec:Processing-Loosely-Coupled}}

To compare performance of IMU component, we will use the same GNSS data set for each project - created in last section. You should not need to re-process GNSS - should you do so you will have to re-process all LC project as well.  

Following subsection will explain detailed settings and workflow for each sensor. The general workflow is the same:

\begin{itemize}
	\item To create a new project 
	\begin{enumerate}
		\item Navigate to project folded and name project (POSRS, SPAN, Microstrain);
		\item Select required GNSS \& IMU files (for ex POSRS.{*});
		\item antenna height 0m, Measured to APR, use antenna profile as for SPAN as this is GNSS rover data you are using;
		\item There is not need to add base station data;
		\item Finish.
	\end{enumerate}
	\item To process Loosely Coupled GNSS/IMU solution go to \textbf{\emph{Process->Process LC}}
		\begin{enumerate}
			\item Select required IMU files only ({*}.imr);
			\item Check orientation of axis and level arms (those are values AFTER the rotation) following table \ref{tab:Lever-Arm-Values};
			\item in \textbf{Advanced...}:
			\begin{itemize}
			 	\item select proper time period for the dataset from first static period to end of last static period identified in section \ref{sec:Static-periods}.
			 	\item select proper method for forward and backward initial alignment
			 	\item press OK.
			 \end{itemize} 
			\item Change description and user;
			\item Click process.
		\end{enumerate}
\end{itemize}




\section{Processing POSRS\label{sub:Processing-POSRS}}

In \textbf{\emph{Process->Process LC}} choose:
\begin{description}
	\item [{update~data}] \emph{External Trajectory; }Use \emph{Browser External} to select {*}.cmb file.
	\item [{POSRS~Profile}] \emph{SPAN Airborne (uIRS)}
	\item [{Lever~Arm~Offset}] use POSRS lever arms from table \ref{tab:Lever-Arm-Values} and select \textbf{\emph{Z to ARP}}
	\item [{Body~to~IMU~Rotation:}] \emph{180,0,90 }
	\end{description}
	
\subsection{POSRS Workflow\label{sub:POSRS-Workflow}}

\begin{enumerate}
	\item Run all automatic. There should be small separation between pitch and roll (70 arc-sec), aligned with large jumps in heading at the beginning and the end (up to 700 arc-sec). This tend to indicate weak starting (and finishing) angle estimate. Everything else should be smooth (within 70 arc-sec).
	\item Plot \emph{Acceleration Profile} and \emph{Velocity Profile} to check if static periods are matching ones from GNSS only processing. Make sure that dataset start and finish on static period changing \textit{IMU Time Range} in \textbf{\emph{Advanced...}} if necessary.
	\item Knowing static periods go to \textbf{\emph{Advanced...}}and in \textbf{\emph{Method for Initial Alignment}} select \emph{Static Coarse+Fine align} for both reverse and forward. Use Coarse: 60-100s, Fine 100-200s. If you have longer static dataset extend fine alignment period. Results should be within 10 arc-sec and there should be no separation between pitch and roll. There will be large jumps in heading at the beginning and end (up to 100 arc-sec) 
	\item Transfer alignment that is use reverse value for forward solution and vice versa.
	\begin{itemize}
		\item In \textbf{\emph{Advanced...}} for the \textbf{\emph{Method for Initial Alignment}} select \emph{Transfer Alignment (enter known attitude) }and press\emph{ Enter Attitude }button. You will do the same for forward and reverse solution.
		\item Click \emph{Get From Trajectory }and select \emph{reverse} POSRS data ({*}.rim) for forward and \emph{forward} POSRS data ({*}.fim) for reverse. Estimated StdDev for both should be similar. Increase it tenfold (x10) to loosen EKF. 
		\item Click OK
		\item Click \emph{Enter Position and Velocity}, click \emph{ Get from Trajectory} and select the same files (they should be already selected). Click \emph{Extract}.
		\item I suggest increase estimated StdDev tenfold (x10) to loosen EKF. 
		\item Click OK three times to get back to \emph{Process Loosely Coupled} screen.
		\item Process data
	\end{itemize}
	\item Results should be within 10 arc-sec for heading and 2 arc-sec for rest. There should be no separation between pitch and roll. Heading separation should be largest in the middle and no jumps at the beginning/end. 
\end{enumerate}

\subsection{Checking results}

To check quality of solution:

\begin{itemize}
	\item To check lever arm in \textbf{\emph{Process->Process LC}} go to \textbf{\emph{Advanced...->States }}and check\emph{ Solve for lever arms. }After reprocessing the data plot\emph{ IMU/IMU-GPS Level Arm} and compare results with values given. Make sure to reprocess data without \emph{Solve for lever arms }for final results and remaining plots.
	\item Plot \emph{Attitude Separation} to check IMU initialisation.
	\item Heading (orientation of axis) can be checked by \emph{IMU Heading COG difference} and \emph{Attitude(Azimuth/Heading)} plots.
	\item To check final position, and quality of LC results plot \emph{Combined Separation, Combined Separation (fix)} and\emph{ IMU/GPS position misclosure}. 
\end{itemize}

\section{Processing SPAN}\label{sub:Processing-SPAN}

In \textbf{\emph{Process->Process LC}} select:
\begin{description}
	\item [{update~data:}] \emph{External Trajectory }(select same {*}.cmb
	file as for POSRS processing)
	\item [{SPAN}] Profile: \emph{SPAN Ground (LCI) }
	\item [{Lever~Arm~~Offset}] use SPAN lever arms from table \ref{tab:Lever-Arm-Values}
	\item [{Body2IMU}] Rotation: \emph{0,0,90}
\end{description}

\subsection{SPAN Workflow\label{sub:SPAN-Workflow}}

\begin{enumerate}
\item Run all automatic. This is purely to check if data is ok.
\item After checking for static data run \emph{Static Coarse+Fine align}, suggested settings are Coarse: 120s, Fine 480s. If you have longer static dataset extend fine alignment period. Results should show improvement over previous one
\item If all is correct transfer alignment from POSRS as described in section \ref{sub:Processing-POSRS}.
\end{enumerate}

\subsection{Checking results}

Same as for POSRS.

\section{Processing Microstrain}\label{sub:Processing-Microstrain}

In \textbf{\emph{Process->Process LC}} select:
\begin{description}
	\item [{update~data}] External Trajectory; Use Browser External to select {*}.cmb file.
	\item [{Profile:}] \emph{SPAN Ground (ADIS16488) }
		\begin{itemize}
			\item go to \textbf{\emph{Advanced...->States}}
			\item Under \emph{Error Model} uncheck \emph{Lock Selection} and select \textbf{\emph{Automotive (Low Precision)}} error model
		\end{itemize}
	\item [{Lever~Arm~Offset}] use POSRS lever arms from table \ref{Lever-Arm-Values}
	\item [{Body2IMU}] Rotation: \emph{180,0,90 }
\end{description}

Follow section \ref{SPAN-Workflow} to obtain all results. Bear in mind that this sensor is of much lower accuracy the other ones and it might be more logical to focus on the smaller subset of the data.

\chapter{Processing IMU on its own}\label{Processing-IMU-on-its-own}

To assess the duration of the gaps (outages) in the GNSS data you will first assess the quality of IMU by processing it on its own. Results will show you system fee-wheeling performance. I advice to copy and rename project control file for each IMU. To run each IMU you need to define starting and ending orientation and position for IMU - this is what you did already in previous section using \emph{Transfer Alignment}. With those setting sin place it is possible to process IMU only data. 

\begin{enumerate}
	\item In \textbf{Process->Process LC} check \textbf{Process IMU Data only} box;
	\item Depending on desired outcome select Both in \textbf{Processing Direction};
	\item Provide proper description;
	\item Click \textbf{Process}.
\end{enumerate}

For higher end IMUs it might be worthwile to select Forward/Reverse settings instead of in Both \textbf{Processing Direction}. Analyse data using plots from last section. Once you have the understanding of sensors accuracy and of duration of GNSS outages you want to introduce head to next section.


\chapter{Simulating the GNSS outage\label{sec:Simulating-GNSS-outage}}

To simulate a GNSS outage you need to remove epochs from GNSS generated trajectory - GNSS.cmb file, \refLoc{ssec:GPS-process}. In {*}.cmb each epoch is represented as:

\begin{lstlisting} [language=Matlab,backgroundcolor=\color{lightgray},frame=single,basicstyle=\footnotesize,numbers=left,numbersep=5pt, numberstyle=\tiny\color{mygray}]
Out {Tim: 121252.00 121252.000000 1777 			  %GPS second HHMMSS.SSS GPS Week
Geo: 52 57 07.03189 -1 11 00.40441 80.5757 0.061 	%vehicle location
Loc: 37.235 2.335 -10.564 0.054 -0.028 -0.002 	
Sta: 2 0.025500 1.31 1.420 0.960 1.040 	
Rms: 0.0282 2.180 0.000 0.023 0.0406 7.880 1.126 	
Var: 3.85994e-003 6.52259e-004 ...	
Ecf: -7.457 37.397 -7.025 	
Acc: -0.010 0.013 0.025 	
Flg: K L 7 6 	
Sep: 0.136 -0.211 0.151 0.069 0.108 0.077 	
Wgt: 2 2 39 61 	
Cov: -4.00800e-004 7.41043e-005 ...
}
\end{lstlisting}

Delete \emph{Out\{...\}} to remove whole epoch. Make sure you don't remove static data used by IMU to initialise. Start with small data gaps and slowly increase their duration. Make sure you work on copy of the GNSS.cmb.\\

Once file has been produced reprocess relevant IMU project using altered GNSS trajectory file. I also suggest experimenting with different settings of \textbf{Processing Direction} in \textbf{Process->Process LC} to fully understand system accuracy.


\chapter{Visualising and exporting  results\label{sec:Exporting-final-results}}

Above sections have outlined technical knowledge needed to process the data and verify the performance of three integrated INS systems. A critical part of your assessment is to draw the conclusions and prepare visualisations and summary of data supporting your findings. It is likely that IE output, discussed below, will be sufficient for that, but you are welcome to summarise some of the results in the tables or plot additional graphs using exported coordinates/data. You are expected to show your own judgement and expertise in selecting output supporting your narrative.

\section{Graphical results}

\begin{itemize}
	\item To save all active plots use\textbf{\emph{ Output->Build HTML Report }}
	\begin{itemize}
		\item Data will be saved in .\\Html folder;
		\item You should have at least two set of plots (testing and final) for each sensor
	\end{itemize}
	\item To output trajectory to Google Earth use\textbf{\emph{ Output->Export to Google Earth...}}. In case of multiple exports it recommended to change the output parameters using \textbf{\emph{Export}} tab:
	\begin{description}
		\item [{Optimize~output~for~trajectory~comparison~in~GE}] creates new colour for the each export\footnote{This also means that export won't follow Quality Numbers,\refLoc{tab:Quality-Number-description}.}. For each run a new folder is created.
		\item [{Use~concise~epoch~description~for~lower~memory~usage}] shortens output information allowing for quick display in Google Earth.
		\item [] First and last option of this menu (\emph{Hold epochs and events to ground }and \emph{Output MSL height for better compatibility with GE elevation data, using}) are mutually exclusive and should be used respectively for terrestrial (ground) and aviation data only.
	\end{description}
\end{itemize}


%Save and check all the plots listed in this walk-trough. You should have at least two set of plots (testing and final) for each sensor. 



\section{Coordinates}


\NOTE{
	To use \textbf{\emph{Export Wizard}} combined solution ({*}.cmb) must exist. It is generated after each LC/TC processing run. It can be also be created using \textbf{\emph{Process->Combine Solution}}. Use extreme caution if using this option.
}

To output post-processed coordinates as ASCII go to \textbf{\emph{Output->Export Wizard}} 	
\begin{itemize}
	\item Select output profile. 
	\begin{itemize}
		\item Mostl likely you will create your own profile using Modify or New buttons.
		\item I suggest outputting either in local grid (East, North, Ellipsoidal Heigh) or Absolute ECEF-XYZ.
		\item Once happy click OK and Next
		\NOTE{
			IE does not produce correct OSGB coordinates. For this experiment you can compare in any grid coordinates, including quasi-OSGB, as long as you mention it. For any other assignment, to obtain those export data as ECEF XYZ and convert it to OSGB use Grid InQuest\footnote{\url{http://www.ordnancesurvey.co.uk/docs/gps/grid-inquest-executable.zip}}.
		}
	\end{itemize}
	\item Select \textbf{\emph{Use processing datum}} and click Next
	\item In this window you define your output parameters
	\begin{itemize}
		\item Define time interval for output (you can interpolate up to 200Hz with POSRS/SPAN but I would recommend outputs of few Hz to keep file sizes reasonable)
		\item Define lever arm using table \ref{tab:Lever-Arm-Values} but read following note in this section before proceeding. 
	\end{itemize}
	
	\NOTE{
		If you followed instruction correctly, your GNSS and IMU level arm will be calculated to antenna ARP but output lever arm will be estimated to antenna phase centre. This means that for EXPORT ONLY your level arm has to be calculated using equation $Arm_{exprt}^{Z}=Arm^{Z}-AntProfile_{L1}^{Z}-AntHeight$. Relevant Arm values can be read from table \ref{tab:Lever-Arm-Values} and antenna profile (\textbf{View->Project Overview}).
	}
	
	
	\item Uncheck \emph{View ASCII} and click \emph{Finish}.
\end{itemize}




\section{Checking results}
Check IMU solution against GNSS one. Export values at ARP (\textbf{SUBTRACT antenna L1 height offsets}). It should agree to few mm in clean environment.  Check between different IMU solutions. SPAN/POSRS should agree on mm to cm level.



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%APPENDIX

\chapter{Appendixes}


\begin{figure}[tbh]
\centering\includegraphics[clip,width=12cm]{pic/VanLayout}%%\resizebox{!}{\textheight}{%Ur object here%}
\caption{Van experiment layout\label{fig:Van-experiment-layout}}
\end{figure}
\begin{figure}[tbh]
\centering\includegraphics[clip,height=12cm]{pic/TrajectoryLayout}%%\resizebox{!}{\textheight}{%Ur object here%}
\caption{Test route plan\label{fig:Van-trajectory}}
\end{figure}


\begin{table}[h]
\centering{}%
\begin{minipage}[t]{1\columnwidth}%
\begin{center}
\begin{tabular}{>{\centering}m{2.5cm}>{\centering}p{2cm}>{\centering}p{3cm}>{\centering}p{3cm}>{\centering}p{3cm}}
\toprule 
\rowcolor{lightgray}Sensor & \multirow{2}{2cm}{Antenna Location} & \multicolumn{3}{>{\centering}p{9cm}}{Lever Arm%
\footnote{Lever arm is estimated to the ARP. Direction IMU to antenna.%
}}\tabularnewline
\rowcolor{lightgray} &  & X & Y & Z\tabularnewline
\midrule
\multirow{2}{2.5cm}{\textbf{POSRS}} & RR & 0.198 & -0.830 & 0.552\tabularnewline
\cmidrule{2-5} 
 & FL & -1.134 & 2.338 & 0.557\tabularnewline
\midrule
\multirow{2}{2.5cm}{\textbf{SPAN }} & RR & 0.307 & -0.626 & 0.543\tabularnewline
\cmidrule{2-5} 
 & FL & -1.025 & 2.542 & 0.583\tabularnewline
\bottomrule
\end{tabular}\caption{Lever Arms for POSRS and SPAN\label{tab:Lever-Arm-Values}}
\par\end{center}%
\end{minipage}
\end{table}


\begin{table}[h]
\centering{}%
\begin{minipage}[t]{1\columnwidth}%
\begin{center}
\begin{tabular}{>{\centering}p{2cm}>{\centering}p{3cm}>{\centering}p{6cm}>{\centering}p{3cm}}
 \rowcolor{lightgray}\textbf{QN} & \textbf{Color} & \textbf{Description} & \textbf{3D Accuracy (m) }\tabularnewline
\midrule
\textbf{1} & \textcolor{green}{Green}%
\footnote{Suggested accuracy for quality testing\label{fn:Suggested-accuracy-QT}%
} & Fixed integer & $\SIrange[range-phrase=\,-\,]{0.00}{0.15}{}$\tabularnewline
\textbf{2} & \textcolor{cyan}{Cyan} \textsuperscript{\ref{fn:Suggested-accuracy-QT}} & Converged float or noisy fixed integer & $\SIrange[range-phrase=\,-\,]{0.05}{0.40}{}$\tabularnewline
\midrule
\textbf{3} & \textcolor{blue}{Blue} & Converging float & $\SIrange[range-phrase=\,-\,]{0.20}{1.00}{}$\tabularnewline
\textbf{4} & \textcolor{purple}{Purple} & Converging float & $\SIrange[range-phrase=\,-\,]{0.50}{2.00}{}$\tabularnewline
\midrule
\textbf{5} & \textcolor{magenta}{Magenta}%
\footnote{Not recommended for LC\label{fn:Not-recommended-LC}%
} & DGPS & $\SIrange[range-phrase=\,-\,]{1.00}{5.00}{}$\tabularnewline
\textbf{6} & \textcolor{red}{Red}\textsuperscript{\ref{fn:Not-recommended-LC}} & DGPS & $\SIrange[range-phrase=\,-\,]{2.00}{10.00}{}$\tabularnewline
\midrule
 & \textcolor{gray}{Grey} & Not processed & \tabularnewline
 \endrule
\end{tabular}\caption{IE Quality Number description\label{tab:Quality-Number-description}}
\par\end{center}%
\end{minipage}
\end{table}
\begin{comment}
	\begin{table}[h]
	\centering{}%
	\begin{minipage}[t]{1\columnwidth}%
	\begin{center}
	\begin{tabular}{>{\raggedright}m{2.5cm}>{\centering}p{3cm}>{\centering}p{3cm}>{\centering}m{3cm}}
	\rowcolor{lightgray} & \multicolumn{2}{>{\centering}p{6cm}}{\textbf{Duration of GNSS outage {[}s{]}}%
	\footnote{Artificially generated, no valid GNSS information.%
	}} & \multirow{4}{3cm}{\begin{sideways}
	\textbf{Drift value {[}m{]}}%
	\footnote{Value is estimated as double the observed difference (to compensate
	for fwd/rev).%
	}
	\end{sideways}}\tabularnewline
	\cmidrule{2-3} 
	\rowcolor{lightgray} & \textbf{100} & \textbf{300} & \tabularnewline
	\cmidrule{1-3} 
	\multirow{1}{2.5cm}{\textbf{POSRS}} & 0.16 & 1.2 & \tabularnewline
	\cmidrule{1-1} 
	\multirow{1}{2.5cm}{\textbf{SPAN }} & 0.60 & 2.8 & \tabularnewline
	\cmidrule{1-3} 
	\end{tabular}\caption{Approximate positional drift value per GNSS outage}
	\par\end{center}%
	\end{minipage}
	\end{table}
	\begin{table}[h]
	\centering{}%
	\begin{minipage}[t]{1\columnwidth}%
	\begin{center}
	\begin{tabular}{>{\centering}p{2.5cm}c>{\centering}p{1.5cm}>{\centering}p{1cm}>{\centering}p{1cm}>{\centering}p{1cm}>{\centering}p{1cm}>{\centering}m{3cm}}
	 & \multicolumn{6}{c}{\textbf{Duration of GNSS outage {[}s{]}}%
	\footnote{Artificially generated, no valid GNSS information.%
	}} & \multirow{6}{3cm}{\begin{sideways}
	\textbf{Drift value {[}m{]}}
	\end{sideways}}\tabularnewline
	 & \multicolumn{3}{c}{\textbf{One way}} & \multicolumn{3}{c}{\textbf{Combined (Two ways)}} & \tabularnewline
	 & \textbf{56} & \textbf{92} & \textbf{401} & \textbf{56} & \textbf{92} & \textbf{401} & \tabularnewline
	\cmidrule(lr){1-1}\cmidrule(rl){2-4}\cmidrule(rl){5-7}\textbf{POSRS} & 0.30? & N/A & 6.83 & 0.30 & 1.60 & 0.91 & \tabularnewline
	\textbf{SPAN } & 0.80 & 2.90 & 127 & 0.43 & 1.50 & 6.83 & \tabularnewline
	\rowcolor{lightgray}\textbf{Microstrain} &  &  &  & 258 & 255 & 2500 & \tabularnewline
	\cmidrule{1-1} 
	\end{tabular}\caption{IMU positional drift during er GNSS outage, based on 2014 results}
	\par\end{center}%
	\end{minipage}
	\end{table}
\end{comment}




\end{document}
